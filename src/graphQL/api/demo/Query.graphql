#import "./Alert.fragment.graphql"

#$is2NotReviewed4Total为true时，只返回“notReviewed4Total”这个字段，为false时，只返回“notReviewedList”、“reviewedList”这两个字段，默认值是false。
query AlertQuery( $params: AL_alarmContentData!, $is2NotReviewed4Total: Boolean = false ){
    #获取所有未复核的总数
    notReviewed4Total: ibms_alarm_getAlarmByContent( params: $params ) @include( if: $is2NotReviewed4Total ){
        unCheckedCount,
    },

    #获取未复核，包括搜索和初始化
    notReviewedList: ibms_alarm_getAlarmByContent( params: $params ) @skip( if: $is2NotReviewed4Total ){
        #根据条件搜索到的总数
        count,
        #未复核的所有总数
        unCheckedCount,
        data{
            ...Alert_Fragment_IAlarm,

            #报警时间
            unCheckedAlarmTime,

            #过往同类事件发生次数
            similarAlarmTotal{
                ...Alert_Fragment_SimilarAlarmTotal,
            },
        },
    },

    #获取已复核，包括搜索和初始化
    reviewedList: ibms_alarm_getMisinformationByContent( params: $params ) @skip( if: $is2NotReviewed4Total ){
        #根据条件搜索到的总数
        count,
        #已复核的所有总数
        checkedCount,
        data{
            ...Alert_Fragment_IAlarm,

            #报警时间
            checkedAlarmTime,
            #复核人编号
            checkedAccountId,
            #设备误报原因
            misinformationMessage,
            #复核时间/处理时间
            reviewTime,
            #复核人报告(故障处理)
            report,
            #复核类型
            reviewType,

            #过往同类事件发生次数
            similarAlarmTotal{
                ...Alert_Fragment_SimilarAlarmTotal,
            },
        },
    },
}

#根据ID查找未复核的，用于验证是否将该ID的未复核状态成功变为已复核状态
query AlertQuery4ID( $params: AL_alarmContentData! ){
    notReviewed4ID: ibms_alarm_getAlarmByContent( params: $params ){
        #根据条件搜索到的总数
        count,
    },
}

#查询登录用户所在的班组，如果不是记录人，则没有预警转工单的权限
query GetCurrentUserGroupsList{
    ua_getCurrentUserGroupsList{
        #唯一id
        id,
        #名称
        name,
        #说明
        description,
        #班组类型（RECORDER:记录组，SEND派单组，PROCESSOR经办组）
        groupsType,
        #当前班组下的所有组员列表
        teamMembers{
            #编号
            id
            #姓名
            name
        }
    }
}
